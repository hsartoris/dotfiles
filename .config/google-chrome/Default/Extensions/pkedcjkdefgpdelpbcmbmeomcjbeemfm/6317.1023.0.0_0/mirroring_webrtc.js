'use strict';var L6={TAB:0,Pi:1,gm:2},M6=function(a){Fb("MediaRouter.WebRtc.Start.Success",a,L6)};var Q6=function(a,b){Jg.call(this,b);this.s=a;this.a=new Jb;this.h=ns(b.id);this.g=new Jb;this.v=!1;this.l=null;this.m=!1;this.u=this.f=null;N6(this);O6(this);P6(this,new Pg("GET_TURN_CREDENTIALS"))};Fa(Q6,Jg);Q6.prototype.start=function(a){var b=this;return this.a.a.then(function(c){if(c.b)return Promise.reject(new Vf("Mirroring already started"));if(b.l)return Promise.reject(new Vf("Session permanently stopped"));b.f=new ub("MediaRouter.WebRtc.Session.Launch");c.a.addStream(a);c.start();return b.g.a})};
Q6.prototype.stop=function(){var a=this;this.g.reject(new Vf("Session stop requested."));this.u&&(this.u.a(),this.u=null);if(this.l)return this.l;this.m=this.v=!1;this.f=null;return this.l=this.a.a.then(function(a){a.stop()}).then(function(){return a.h.Ja()}).catch(function(b){a.h.Ja();throw b;})};
var N6=function(a){a.h.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.a.resolve(new Ug(a.b.id,b.data.credentials));break;case "ANSWER":a.a.a.then(function(a){bh(a,b.data)});break;case "KNOCK_ANSWER":a.m=!0;a.a.a.then(function(a){bh(a,b.data)});break;case "STOP":a.g.reject(new Vf("Stop signal received"));a.stop();break;default:throw new Vf("Unknown message type: "+b.type);}}},O6=function(a){a.a.a.then(function(b){Yg(b,function(b){P6(a,
new Pg("OFFER",new Rg(b,a.s,Sg)))});Zg(b,function(b){P6(a,Qg(b))});Vg(b,function(){a.v=!0;P6(a,new Pg("SESSION_START_SUCCESS"));!a.m&&a.f&&a.f.a();a.f=null;a.u=new Bb("MediaRouter.WebRtc.Session.Length");a.g.resolve(a)});Xg(b,function(){P6(a,new Pg("SESSION_END"))});Wg(b,function(b){a.v||a.g.reject(b);P6(a,new Pg("SESSION_FAILURE"))})})},P6=function(a,b){a.h.sendMessage(b,R6)},R6={channelType:"cloud"};var S6=function(){zg.call(this,"webrtc")};Fa(S6,zg);h=S6.prototype;h.qg=function(a,b){return new Q6(a,b)};h.Yg=function(){M6(0)};h.Vg=function(){M6(1)};h.ri=function(){M6(2)};h.Wg=function(){Eb("MediaRouter.WebRtc.Session.End")};h.Xg=function(a){Fb("MediaRouter.WebRtc.Start.Failure",a,Uf)};h.Jf=function(){Eb("MediaRouter.WebRtc.Stream.End")};var T6=new S6;yg("mr.mirror.webrtc.WebRtcService",T6);
